<!DOCTYPE html>
<html lang="en">
<head>
    <link id="pagestyle" href="../assets/css/Layout.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/simplebar@latest/dist/simplebar.css" />
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Heart Dashboard</title>
</head>
<body>
   <!--PC 네비바-->
   <nav class="nav-pc">
        <div class="hamburger-pc" id="hamburger-pc">☰</div>
        <ul class="nav-links" id="nav-links">
            <li><a href="/dashboard"><img src="../assets/img/bottom_icon03-w.png"><span>메인보드</span></a></li>
            <li><a href="/beat-track"><img src="../assets/img/bottom_icon02-w.png"><span>트레이닝</span></a></li>
            <li><a href="/training-record"><img src="../assets/img/bottom_icon04-w.png"><span>트레이닝 기록</span></a></li>        
        </ul>
        <div class="user-profile-img"><img id="profile-img-pc" src="" alt="프로필 이미지"></div>
        <div class="nav-logout logout"><a href="/logout"></a><img src="../assets/img/logout-w.png"><span>로그아웃</span></div>    
    </nav>
    <div class="overlay" id="overlay"></div>
    <!-- 모바일 네비바 -->
    <div class="bar">Heart Rate Monitor</div>
    <div class="hamburger-mob" id="hamburger-mob">☰</div> 
    <nav class="nav-mob" id="nav-mob">
        <a href="/dashboard">메인 보드</a>
        <a href="/beat-track">트레이닝</a>
        <a href="/training-record">트레이닝 기록</a>
    </nav>

    <!--pc 전용 레이아웃-->
    <div class="wrap-cont-pc">
        <div class="">
            <a href="/dashboard"><img src="../assets/img/logo.png"></a>
        </div>
        <div class="first-row">
            <div class="rt-heart-board">
                <div class="container-title" style="color: #fff;"> 실시간 </div>
                <ul>
                    <li><img src="../assets/img/heart-shape.png" alt=""></li>
                    <li><div class="heart-rate-container-big">
                        <div class="heart-rate">Real Time</div>
                        <div class="heart-rate"><span class="real-time">
                            <div class="bpmValue">0</div></span></div>
                    </li>
                </ul>
            </div>        
            <div class="status-container">
                <div class="outer-circle"></div>
                <div class="inner-circle"></div>
                <div class="status-icon">
                    <img src="../assets/img/sleep.png"  class="dynamicImage">
                    <span class="status-text">sleep</span>
                </div>
            </div>
            <div class="average-heart-board">
                <div class="container-title">시간대별 평균</div>
                <div class="heart-board-wrap">
                    <div class="heart-rate-row">
                        <div class="heart-rate-container">
                            <div class="heart-rate">분 평균</div>
                            <div class="heart-rate">
                                <div class="minbpmContainer">0</div>
                            </div>
                        </div>
                        <div class="heart-rate-container">
                            <div class="heart-rate">시간 평균</div>
                            <div class="heart-rate">
                                <div class="hourbpmContainer">0</div>
                            </div>
                        </div>
                        <div class="heart-rate-container">
                            <div class="heart-rate">일 평균</div>
                            <div class="heart-rate">
                                <div class="daybpmContainer">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="heart-rate-row">
                        <div class="heart-rate-container">
                            <div class="heart-rate">주 평균</div>
                            <div class="heart-rate">
                                <div class="weekbpmContainer">0</div>
                            </div>
                        </div>
                        <div class="heart-rate-container">
                            <div class="heart-rate">월 평균</div>
                            <div class="heart-rate">
                                <div class="monthbpmContainer">0</div>
                            </div>
                        </div>
                        <div class="heart-rate-container">
                            <div class="heart-rate">연 평균</div>
                            <div class="heart-rate">
                                <div class="yearbpmContainer">0</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="second-row">
            <div class="donut-chart-container">
                <div class="container-title">하루 활동 통계</div>
                <div class="donut-chart-wrap">
                    <canvas class="donut-graph" width="300" height="300"></canvas>
                </div>
            </div>
            <div class="bar-chart-container"  data-simplebar style="overflow-x: auto; overflow-y:hidden; white-space:nowrap;">
                <div class="container-title">시간별 활동 통계</div>
                <div class="bar-chart-wrap" >
                    <canvas class="bar-graph" width="1000" height="300" style="padding-bottom: 20px;"></canvas>
                </div>
            </div>
        </div>
        <div class="third-row">
            <div class="pc-chart-container">
                <div class="container-title">심박수 평균</div>
                <ul class="button-container">
                    <li class="button active"><a href="#" data-url="hourly-chart">Daily</a></li>
                    <li class="button"><a href="#" data-url="weekly-chart">Weekly</a></li>
                    <li class="button"><a href="#" data-url="monthly-chart">Monthly</a></li>
                </ul>
                <div class="pc-chart-wrap" style="height: 90%;">
                    <canvas class="graph" ></canvas>
                </div>
            </div>
        </div>
    </div>

    <!--모바일 전용 레이아웃-->
    <div class="wrap-cont">
        <h1>(로그인사용자) <div class="status" style="margin-bottom: 16px; margin-top:16px;">
            <img src="../assets/img/normal.png" class="dynamicImage">
            <span class="status-text"></span>
        </div></h1>        
        <div class="dash-board">
            <div class="heart-board">         
                <ul>
                    <li><img src="../assets/img/heart-shape.png" alt=""></li>
                    <li><div class="heart-rate-container-big">
                        <div class="heart-rate">Real Time</div>
                        <div class="heart-rate"><span class="real-time">
                            <div class="bpmValue">0</div></span></div>
                    </li>
                </ul>
            </div>
            <div class="scroll-board" data-simplebar>
                <div class="heart-rate-container">
                    <div class="heart-rate">분 평균</div>
                    <div class="heart-rate">
                        <div class="minbpmContainer">0</div>
                    </div>
                </div>
                <div class="heart-rate-container">
                    <div class="heart-rate">시간 평균</div>
                    <div class="heart-rate">
                        <div class="hourbpmContainer">0</div>
                    </div>
                </div>
                <div class="heart-rate-container">
                    <div class="heart-rate">일 평균</div>
                    <div class="heart-rate">
                        <div class="daybpmContainer">0</div>
                    </div>
                </div>
                <div class="heart-rate-container">
                    <div class="heart-rate">주 평균</div>
                    <div class="heart-rate">
                        <div class="weekbpmContainer">0</div>
                    </div>
                </div>
                <div class="heart-rate-container">
                    <div class="heart-rate">월 평균</div>
                    <div class="heart-rate">
                        <div class="monthbpmContainer">0</div>
                    </div>
                </div>
                <div class="heart-rate-container">
                    <div class="heart-rate">연 평균</div>
                    <div class="heart-rate">
                        <div class="yearbpmContainer">0</div>
                    </div>
                </div>
            </div>
        </div>
    
        <div class="chart-container-main">
            <div class="container-title-main">심박수 평균</div>
            <ul class="button-container">
                <li class="button active"><a href="#" data-url="hourly-chart">Daily</a></li>
                <li class="button"><a href="#" data-url="weekly-chart">Weekly</a></li>
                <li class="button"><a href="#" data-url="monthly-chart">Monthly</a></li>
            </ul>
            <div class="chart-wrap-main">
                <canvas class="graph" ></canvas>
            </div>
        </div>  
        <div class="chart-container">
            <div class="container-title">하루 활동 통계</div>
            <div class="chart-wrap">
                <canvas class="donut-graph" width="300" height="300"></canvas>
            </div>
        </div>
        <div class="chart-container">
            <div class="container-title">시간별 활동 통계</div>
            <div class="chart-wrap">
                <canvas class="bar-graph" width="1000" height="300" style="padding-bottom: 20px;"></canvas>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/simplebar@latest/dist/simplebar.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const profileImg = document.getElementById('profile-img-pc');
            const logoutLink = document.querySelector('.nav-logout a');

            // Dummy user profile data
            const userProfile = {
                imageUrl: 'path/to/user/profile.jpg', // Replace with actual user profile image URL
                isLoggedIn: true // Replace with actual login status
            };

            // Update profile image and logout link visibility
            if (userProfile.isLoggedIn) {
                profileImg.src = userProfile.imageUrl;
                logoutLink.style.display = 'block';
            } else {
                profileImg.style.display = 'none';
                logoutLink.style.display = 'none';
            }

            // Toggle for mobile nav
            document.getElementById('hamburger-mob').addEventListener('click', function() {
                document.getElementById('nav-mob').classList.toggle('show');
            });

            // Toggle for PC nav
            document.getElementById('hamburger-pc').addEventListener('click', function() {
                document.getElementById('overlay').classList.toggle('show');
                document.getElementById('nav-links').classList.toggle('show');
            });

            // Chart.js setup
            let graphCanvas = document.querySelector('.graph').getContext('2d');
            let barGraphCanvas = document.querySelector('.bar-graph').getContext('2d');
            let donutGraphCanvas = document.querySelector('.donut-graph').getContext('2d');

            let graph = new Chart(graphCanvas, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Heart Rate',
                        data: [],
                        backgroundColor: 'rgba(255, 99, 132, 0.2)',
                        borderColor: 'rgba(255, 99, 132, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });

            let barGraph = new Chart(barGraphCanvas, {
                type: 'bar',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'Hourly Activity',
                        data: [],
                        backgroundColor: 'rgba(54, 162, 235, 0.2)',
                        borderColor: 'rgba(54, 162, 235, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        yAxes: [{
                            ticks: {
                                beginAtZero: true
                            }
                        }]
                    }
                }
            });

            let donutGraph = new Chart(donutGraphCanvas, {
                type: 'doughnut',
                data: {
                    labels: ['Activity 1', 'Activity 2', 'Activity 3'],
                    datasets: [{
                        label: 'Daily Activities',
                        data: [10, 20, 30],
                        backgroundColor: [
                            'rgba(255, 99, 132, 0.2)',
                            'rgba(54, 162, 235, 0.2)',
                            'rgba(255, 206, 86, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 99, 132, 1)',
                            'rgba(54, 162, 235, 1)',
                            'rgba(255, 206, 86, 1)'
                        ],
                        borderWidth: 1
                    }]
                }
            });

            async function fetchData(url) {
                try {
                    const response = await fetch(url);
                    const responseData = await response.json();
                    console.log(responseData);

                    if (responseData.session === 'none') {
                        alert('세션이 만료되었습니다. 로그인 페이지로 이동합니다.');
                        window.location.href = '/login';
                        return;
                    }

                    // 데이터 업데이트
                    graph.data.labels = responseData.labels;
                    graph.data.datasets[0].data = responseData.data;
                    graph.update();

                    barGraph.data.labels = responseData.labels;
                    barGraph.data.datasets[0].data = responseData.data;
                    barGraph.update();

                    donutGraph.data.labels = responseData.labels;
                    donutGraph.data.datasets[0].data = responseData.data;
                    donutGraph.update();
                } catch (error) {
                    console.error('데이터를 가져오는 동안 오류가 발생했습니다:', error);
                }
            }

            document.querySelectorAll('.button a').forEach(button => {
                button.addEventListener('click', function(event) {
                    event.preventDefault();
                    const url = event.target.getAttribute('data-url');
                    fetchData(url);
                });
            });

            // 초기 데이터 로드
            fetchData('/hourly-chart');
        });
    </script>
</body>
</html>
